import"core-js/modules/es.array.concat";import"core-js/modules/es.promise";import"core-js/modules/es.object.to-string";import"core-js/modules/es.function.bind";import a from"regenerator-runtime";import{ValidationError as b}from"myzod";import{StandardErrorResponseSchema as c}from"../types";import d from"../types/error/failed_to_get_credential";import e from"../types/error/api_error";function asyncGeneratorStep(f,g,h,i,j,k,l){try{var m=f[k](l),n=m.value}catch(o){return void h(o)}m.done?g(n):Promise.resolve(n).then(i,j)}function _asyncToGenerator(p){return function(){var q=this,r=arguments;return new Promise(function(g,h){var f=p.apply(q,r);function i(n){asyncGeneratorStep(f,g,h,i,j,"next",n)}function j(s){asyncGeneratorStep(f,g,h,i,j,"throw",s)}i(void 0)})}}function _classCallCheck(t,u){if(!(t instanceof u))throw new TypeError("Cannot call a class as a function")}function _defineProperties(v,w){for(var x=0;x<w.length;x++){var y=w[x];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}}function _createClass(u,z,A){return z&&_defineProperties(u.prototype,z),A&&_defineProperties(u,A),u}function _defineProperty(B,k,n){return k in B?Object.defineProperty(B,k,{value:n,enumerable:!0,configurable:!0,writable:!0}):B[k]=n,B}function _objectSpread(v){for(var x=1;x<arguments.length;x++){var C=null!=arguments[x]?arguments[x]:{},D=Object.keys(C);"function"==typeof Object.getOwnPropertySymbols&&(D=D.concat(Object.getOwnPropertySymbols(C).filter(function(E){return Object.getOwnPropertyDescriptor(C,E).enumerable}))),D.forEach(function(k){_defineProperty(v,k,C[k])})}return v}function _objectWithoutProperties(C,F){if(null==C)return{};var k,x,v=_objectWithoutPropertiesLoose(C,F);if(Object.getOwnPropertySymbols){var G=Object.getOwnPropertySymbols(C);for(x=0;x<G.length;x++)k=G[x],!(F.indexOf(k)>=0)&&Object.prototype.propertyIsEnumerable.call(C,k)&&(v[k]=C[k])}return v}function _objectWithoutPropertiesLoose(C,F){if(null==C)return{};var k,x,v={},H=Object.keys(C);for(x=0;x<H.length;x++)k=H[x],F.indexOf(k)>=0||(v[k]=C[k]);return v}var Client=function(){"use strict";function Client(){_classCallCheck(this,Client),this.backendURI="https://api.csc.deershark.com/api"}return _createClass(Client,[{key:"BackendURI",get:function(){return this.backendURI},set:function(I){this.backendURI=I}},{key:"baseFetcher",value:function(J,K){var L=void 0===K?{headers:{}}:K,M=L.headers,N=_objectWithoutProperties(L,["headers"]);return fetch("".concat(this.BackendURI).concat(J),_objectSpread({},N,{headers:_objectSpread({},M,{"User-Agent":"cscheckin-sdk-std/2.0"})}))}},{key:"jsonFetcher",value:function(O,P){return _asyncToGenerator(a.mark(function _callee(){var Q;return a.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,this.baseFetcher(O,P);case 2:return Q=R.sent,R.next=5,Q.json();case 5:return R.abrupt("return",{data:R.sent,statusCode:Q.status});case 6:case"end":return R.stop()}},_callee,this)}).bind(this))()}},{key:"textFetcher",value:function(S,T){return _asyncToGenerator(a.mark(function _callee(){var U;return a.wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.next=2,this.baseFetcher(S,T);case 2:return U=V.sent,V.next=5,U.text();case 5:return V.abrupt("return",{data:V.sent,statusCode:U.status});case 6:case"end":return V.stop()}},_callee,this)}).bind(this))()}}],[{key:"getInstance",value:function(){return Client.instance||(Client.instance=new Client()),Client.instance}},{key:"authRequest",value:function(W,X){var Y=void 0===X?{headers:{}}:X;return _asyncToGenerator(a.mark(function _callee(){var Z,$,_;return a.wrap(function(aa){for(;;)switch(aa.prev=aa.next){case 0:return Z=Y.headers,$=_objectWithoutProperties(Y,["headers"]),aa.next=3,W.getAuthenticationHeader();case 3:if(_=aa.sent){aa.next=6;break}throw new d();case 6:return aa.abrupt("return",_objectSpread({},$,{headers:_objectSpread({},Z,{Authorization:_})}));case 7:case"end":return aa.stop()}},_callee)}))()}},{key:"postJsonRequest",value:function(ba,ca){var da=void 0===ca?{headers:{}}:ca,ea=da.headers;return _objectSpread({},_objectWithoutProperties(da,["headers"]),{body:JSON.stringify(ba),method:"POST",headers:_objectSpread({},ea,{"Content-Type":"application/json"})})}},{key:"responseParser",value:function(fa,ga){var ha=ga.try(fa);if(ha instanceof b){var ia=c.try(fa);if(ia instanceof b)throw ia;if(ia.message)throw new e(ia.message);if(ia.error)throw new e(ia.error);throw ha}return ha}},{key:"isResponseOk",value:function(ja){return ja>=200&&ja<=299}}]),Client}();Client.instance=null;export{Client as default};export var clientInstance=Client.getInstance()