import"core-js/modules/es.function.bind";import"core-js/modules/es.array.concat";import a from"regenerator-runtime";import b from"myzod";import c from"./logic/auth/get_access_token";import d from"./logic/auth/get_user_info";import e from"./logic/auth/revoke_access_token";import f from"./logic/auth/set_ident";import{AuthTokenResponseSchema as g,AuthUserResponseSchema as h}from"./types";function asyncGeneratorStep(i,j,k,l,m,n,o){try{var p=i[n](o),q=p.value}catch(r){return void k(r)}p.done?j(q):Promise.resolve(q).then(l,m)}function _asyncToGenerator(s){return function(){var t=this,u=arguments;return new Promise(function(j,k){var i=s.apply(t,u);function l(q){asyncGeneratorStep(i,j,k,l,m,"next",q)}function m(v){asyncGeneratorStep(i,j,k,l,m,"throw",v)}l(void 0)})}}function _classCallCheck(w,x){if(!(w instanceof x))throw new TypeError("Cannot call a class as a function")}function _defineProperties(y,z){for(var A=0;A<z.length;A++){var B=z[A];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(y,B.key,B)}}function _createClass(x,C,D){return C&&_defineProperties(x.prototype,C),D&&_defineProperties(x,D),x}export var CSCAuthExportStructure=b.object({gIdToken:b.string(),gAccessToken:b.string(),accessData:g.optional()});var CSCAuth=function(){"use strict";function CSCAuth(E,F){_classCallCheck(this,CSCAuth),this.gIdToken=E,this.gAccessToken=F,this.accessData=null}return _createClass(CSCAuth,[{key:"getAccessData",value:function(){return _asyncToGenerator(a.mark(function _callee(){var G;return a.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(this.accessData){H.next=5;break}return H.next=3,c({id_token:this.gIdToken,access_token:this.gAccessToken});case 3:G=H.sent,this.accessData=g.parse(G);case 5:return H.abrupt("return",this.accessData);case 6:case"end":return H.stop()}},_callee,this)}).bind(this))()}},{key:"getAuthenticationHeader",value:function(){return _asyncToGenerator(a.mark(function _callee(){var I;return a.wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,this.getAccessData();case 2:return I=J.sent,J.abrupt("return","Bearer ".concat(I.access_token));case 4:case"end":return J.stop()}},_callee,this)}).bind(this))()}},{key:"userInfo",value:function(){return _asyncToGenerator(a.mark(function _callee(){var K;return a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,d(this);case 2:return K=L.sent,L.abrupt("return",h.parse(K));case 4:case"end":return L.stop()}},_callee,this)}).bind(this))()}},{key:"setIdentity",value:function(M,N){return _asyncToGenerator(a.mark(function _callee(){return a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.abrupt("return",f({"class":M,number:N},this));case 1:case"end":return O.stop()}},_callee,this)}).bind(this))()}},{key:"revoke",value:function(){return _asyncToGenerator(a.mark(function _callee(){return a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.abrupt("return",e(this));case 1:case"end":return P.stop()}},_callee,this)}).bind(this))()}},{key:"export",value:function(){return JSON.stringify({gAccessToken:this.gAccessToken,gIdToken:this.gIdToken,accessData:this.accessData})}}],[{key:"import",value:function(Q){var R=CSCAuthExportStructure.parse(JSON.parse(Q)),S=R.gAccessToken,T=R.gIdToken,U=R.accessData,V=new CSCAuth(S,T);return V.accessData=U||null,V}}]),CSCAuth}();export{CSCAuth as default}