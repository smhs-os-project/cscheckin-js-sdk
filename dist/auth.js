"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.CSCAuthExportStructure=void 0,require("core-js/modules/es.function.bind"),require("core-js/modules/es.array.concat");var _regeneratorRuntime=_interopRequireDefault(require("regenerator-runtime")),_myzod=_interopRequireDefault(require("myzod")),_getAccessToken=_interopRequireDefault(require("./logic/auth/get_access_token")),_getUserInfo=_interopRequireDefault(require("./logic/auth/get_user_info")),_revokeAccessToken=_interopRequireDefault(require("./logic/auth/revoke_access_token")),_setIdent=_interopRequireDefault(require("./logic/auth/set_ident")),_types=require("./types");function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(j){c(j);return}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(k){return function(){var l=this,m=arguments;return new Promise(function(b,c){var a=k.apply(l,m);function d(i){asyncGeneratorStep(a,b,c,d,e,"next",i)}function e(n){asyncGeneratorStep(a,b,c,d,e,"throw",n)}d(void 0)})}}function _classCallCheck(o,p){if(!(o instanceof p))throw new TypeError("Cannot call a class as a function")}function _defineProperties(q,r){for(var s=0;s<r.length;s++){var t=r[s];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(q,t.key,t)}}function _createClass(p,u,v){return u&&_defineProperties(p.prototype,u),v&&_defineProperties(p,v),p}function _interopRequireDefault(w){return w&&w.__esModule?w:{default:w}}var CSCAuthExportStructure=_myzod.default.object({gIdToken:_myzod.default.string(),gAccessToken:_myzod.default.string(),accessData:_types.AuthTokenResponseSchema.optional()});exports.CSCAuthExportStructure=CSCAuthExportStructure;var CSCAuth=function(){"use strict";function CSCAuth(x,y){_classCallCheck(this,CSCAuth),this.gIdToken=x,this.gAccessToken=y,this.accessData=null}return _createClass(CSCAuth,[{key:"getAccessData",value:function(){return _asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(){var z;return _regeneratorRuntime.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(this.accessData){A.next=5;break}return A.next=3,_getAccessToken.default({id_token:this.gIdToken,access_token:this.gAccessToken});case 3:z=A.sent,this.accessData=_types.AuthTokenResponseSchema.parse(z);case 5:return A.abrupt("return",this.accessData);case 6:case"end":return A.stop()}},_callee,this)}).bind(this))()}},{key:"getAuthenticationHeader",value:function(){return _asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(){var B;return _regeneratorRuntime.default.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,this.getAccessData();case 2:return B=C.sent,C.abrupt("return","Bearer ".concat(B.access_token));case 4:case"end":return C.stop()}},_callee,this)}).bind(this))()}},{key:"userInfo",value:function(){return _asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(){var D;return _regeneratorRuntime.default.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,_getUserInfo.default(this);case 2:return D=E.sent,E.abrupt("return",_types.AuthUserResponseSchema.parse(D));case 4:case"end":return E.stop()}},_callee,this)}).bind(this))()}},{key:"setIdentity",value:function(F,G){return _asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(){return _regeneratorRuntime.default.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.abrupt("return",_setIdent.default({"class":F,number:G},this));case 1:case"end":return H.stop()}},_callee,this)}).bind(this))()}},{key:"revoke",value:function(){return _asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(){return _regeneratorRuntime.default.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.abrupt("return",_revokeAccessToken.default(this));case 1:case"end":return I.stop()}},_callee,this)}).bind(this))()}},{key:"export",value:function(){return JSON.stringify({gAccessToken:this.gAccessToken,gIdToken:this.gIdToken,accessData:this.accessData})}}],[{key:"import",value:function(J){var K=CSCAuthExportStructure.parse(JSON.parse(J)),L=K.gAccessToken,M=K.gIdToken,N=K.accessData,O=new CSCAuth(L,M);return O.accessData=N||null,O}}]),CSCAuth}();exports.default=CSCAuth
//# sourceMappingURL=auth.js.map